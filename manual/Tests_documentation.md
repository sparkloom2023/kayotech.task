
### 2. مستندات تست‌ها

```markdown
# مستندات تست‌های پروژه مدیریت تسک‌ها

این سند به توضیح تست‌های نوشته‌شده برای پروژه مدیریت تسک‌ها می‌پردازد. تست‌ها با استفاده از فریم‌ورک Pest نوشته شده‌اند و رفتار سیستم را در سناریوهای مختلف بررسی می‌کنند. تست‌ها در دو فایل اصلی قرار دارند: `TaskStatusUpdateTest.php` و `TaskStatusUpdateViaSubtaskControllerTest.php`.

## فایل `TaskStatusUpdateTest.php`

این فایل تست‌های مربوط به ایجاد و به‌روزرسانی تسک‌ها و زیرتسک‌ها را پوشش می‌دهد.

### 1. ایجاد تسک با زیرتسک‌ها و حفظ وضعیت به صورت `todo`
- **هدف**: بررسی صحت ایجاد یک تسک به همراه زیرتسک‌ها و اطمینان از تنظیم صحیح وضعیت تسک روی `todo`.
- **سناریو**:
  - یک درخواست POST برای ایجاد تسک با دو زیرتسک (هر دو با وضعیت `not_done`) ارسال می‌شود.
  - بررسی می‌شود که تسک با موفقیت ایجاد شده، وضعیت آن `todo` باشد و تعداد زیرتسک‌ها ۲ باشد.
- **انتظار**:
  - ریدایرکت به مسیر `tasks.index`.
  - عنوان تسک و تعداد زیرتسک‌ها مطابق با داده‌های ارسالی باشد.

### 2. به‌روزرسانی خودکار تسک‌ها وقتی وضعیت زیرتسک‌ها به `done` تغییر کند
- **هدف**: بررسی عملکرد به‌روزرسانی خودکار وضعیت تسک به `done` در صورتی که همه زیرتسک‌ها به وضعیت `done` تغییر کنند.
- **سناریو**:
  - یک تسک با دو زیرتسک (هر دو با وضعیت اولیه `not_done`) ایجاد می‌شود.
  - درخواست PUT برای به‌روزرسانی تسک ارسال می‌شود که در آن وضعیت هر دو زیرتسک به `done` تغییر می‌کند.
  - بررسی می‌شود که وضعیت تسک به `done` تغییر کرده و زیرتسک‌ها به درستی به‌روزرسانی شده‌اند.
- **انتظار**:
  - ریدایرکت به مسیر `tasks.index`.
  - وضعیت تسک به `done` تغییر کند.
  - تعداد زیرتسک‌ها همچنان ۲ باشد و وضعیت همه آن‌ها `done` باشد.

## فایل `TaskStatusUpdateViaSubtaskControllerTest.php`

این فایل تست‌های مربوط به کنترلر `SubtaskController` را پوشش می‌دهد و رفتار به‌روزرسانی و حذف زیرتسک‌ها را بررسی می‌کند.

### 1. به‌روزرسانی یک زیرتسک و ریدایرکت به صفحه تسک‌ها
- **هدف**: اطمینان از به‌روزرسانی صحیح یک زیرتسک و ریدایرکت به صفحه تسک‌ها.
- **سناریو**:
  - یک تسک و یک زیرتسک با وضعیت `not_done` ایجاد می‌شود.
  - درخواست PUT برای به‌روزرسانی زیرتسک با عنوان، وضعیت و تاریخ سررسید جدید ارسال می‌شود.
  - بررسی می‌شود که زیرتسک به درستی به‌روزرسانی شده و پیام موفقیت نمایش داده می‌شود.
- **انتظار**:
  - ریدایرکت به مسیر `tasks.index`.
  - نمایش پیام موفقیت: "Subtask updated successfully."
  - مقادیر زیرتسک (عنوان، وضعیت، تاریخ سررسید) مطابق با داده‌های ارسالی باشد.

### 2. به‌روزرسانی وضعیت تسک به `done` وقتی همه زیرتسک‌ها `done` باشند
- **هدف**: بررسی عملکرد به‌روزرسانی خودکار وضعیت تسک به `done` در صورتی که همه زیرتسک‌ها به وضعیت `done` تغییر کنند (از طریق `SubtaskController`).
- **سناریو**:
  - یک تسک با دو زیرتسک (یکی `not_done` و دیگری `done`) ایجاد می‌شود.
  - درخواست PUT برای تغییر وضعیت زیرتسک `not_done` به `done` ارسال می‌شود.
  - بررسی می‌شود که وضعیت تسک به `done` تغییر کرده و زیرتسک به درستی به‌روزرسانی شده است.
- **انتظار**:
  - ریدایرکت به مسیر `tasks.index`.
  - نمایش پیام موفقیت: "Subtask updated successfully."
  - وضعیت تسک به `done` تغییر کند.
  - وضعیت زیرتسک به‌روزرسانی‌شده به `done` باشد.

### 3. حذف یک زیرتسک و ریدایرکت به صفحه تسک‌ها
- **هدف**: اطمینان از حذف صحیح یک زیرتسک و ریدایرکت به صفحه تسک‌ها.
- **سناریو**:
  - یک تسک و یک زیرتسک با وضعیت `not_done` ایجاد می‌شود.
  - درخواست DELETE برای حذف زیرتسک ارسال می‌شود.
  - بررسی می‌شود که زیرتسک با موفقیت حذف شده و پیام موفقیت نمایش داده می‌شود.
- **انتظار**:
  - ریدایرکت به مسیر `tasks.index`.
  - نمایش پیام موفقیت: "Subtask deleted successfully."
  - زیرتسک در دیتابیس وجود نداشته باشد.

## نکات کلی تست‌ها
- **محیط تست**: تست‌ها از دیتابیس SQLite حافظه‌ای (`:memory:`) استفاده می‌کنند تا از تأثیر بر دیتابیس توسعه جلوگیری شود.
- **پیام‌های موفقیت**: تست‌ها بررسی می‌کنند که پیام‌های موفقیت پس از هر عملیات به درستی در سشن ذخیره شوند.
- **اعتبارسنجی**: تست‌ها اطمینان می‌دهند که اعتبارسنجی داده‌ها (مانند الزامی بودن عنوان) به درستی انجام می‌شود.
